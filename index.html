<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Danbooru Prompt Generator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --base: #231e1c;
      --mantle: #1a1614;
      --crust: #0f0d0c;
      --text: #e3d8c9;
      --subtext: #c5b7a3;
      --overlay: #5a5149;
      --surface: #2a231e;
      --accent: #d4875d;
      --highlight: #7a6a9a;
      --green: #5c7c46;
      --red: #9a2a2a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--mantle);
      color: var(--text);
      line-height: 1.4;
      padding: 0.5rem;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding-bottom: 2rem;
    }
    header {
      text-align: center;
      padding: 1rem 0;
    }
    header h1 {
      font-size: 1.8rem;
      color: var(--highlight);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    header p {
      font-size: 0.95rem;
      color: var(--subtext);
    }

    .prompt-container {
      background: var(--surface);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }
    textarea {
      width: 100%;
      min-height: 100px;
      background: var(--base);
      color: var(--text);
      border: 1px solid var(--overlay);
      border-radius: 6px;
      padding: 0.8rem;
      font-size: 0.95rem;
      resize: vertical;
    }
    .prompt-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--subtext);
      margin-top: 0.5rem;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.8rem;
    }
    button {
      flex: 1;
      padding: 0.6rem;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover { transform: translateY(-1px); }
    .clear-btn { background: var(--red); color: #fff; }
    .copy-btn  { background: var(--green); color: #fff; }
    .random-btn{ background: var(--highlight); color: #fff; }

    .custom-tag-container {
      background: var(--surface);
      border-radius: 8px;
      padding: 0.8rem;
      margin-top: 1rem;
    }
    .custom-tag-container h3 {
      font-size: 1rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.6rem;
    }
    .custom-tag-input {
      display: flex;
      gap: 0.4rem;
    }
    .custom-tag-input input {
      flex: 1;
      padding: 0.6rem;
      border-radius: 6px;
      border: 1px solid var(--overlay);
      background: var(--base);
      color: var(--text);
      font-size: 0.9rem;
    }
    .custom-tag-input button {
      background: var(--green);
      color: #fff;
      padding: 0.6rem;
      border-radius: 6px;
    }

    .categories-container {
      margin-top: 1rem;
    }
    .category-card {
      background: var(--surface);
      border-radius: 8px;
      margin-bottom: 0.8rem;
      overflow: hidden;
      border: 1px solid var(--overlay);
    }
    .category-header {
      padding: 0.7rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
    }
    .category-header h2 {
      font-size: 1rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .category-header i {
      transition: transform 0.3s;
      transform: rotate(180deg);
    }
    .category-card.collapsed .category-header i { transform: rotate(0deg); }

    .tag-section {
      padding: 0.8rem 1rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 0.5rem;
      /* Removed fixed height and scroll */
    }
    .tag-container {
      background: var(--base);
      border-radius: 6px;
      padding: 0.6rem;
      border: 1px solid var(--overlay);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .tag-container:hover { transform: translateY(-2px); }
    .tag { font-size: 0.95rem; font-weight: bold; color: var(--text); margin-bottom: 0.3rem; }
    .description { font-size: 0.8rem; color: var(--subtext); }

    footer {
      text-align: center;
      font-size: 0.8rem;
      color: var(--subtext);
      margin-top: 1rem;
    }

    /* Collapsed tag-section */
    .category-card.collapsed .tag-section { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-cube"></i> Danbooru Prompt Generator</h1>
      <p>Create complex prompts by selecting tags below</p>
    </header>
    <div class="prompt-container">
      <textarea id="promptField" placeholder="Your prompt will appear here..."></textarea>
      <div class="prompt-info">
        <span>Tags: <span id="tagCount">0</span></span>
        <span>Chars: <span id="charCount">0</span></span>
      </div>
      <div class="controls">
        <button class="clear-btn" onclick="clearPrompt()"><i class="fas fa-trash"></i> Clear</button>
        <button class="copy-btn" onclick="copyPrompt()"><i class="fas fa-copy"></i> Copy</button>
        <button class="random-btn" onclick="addRandomTags()"><i class="fas fa-random"></i> Random</button>
      </div>
      <div class="custom-tag-container">
        <h3><i class="fas fa-tag"></i> Custom Tag</h3>
        <div class="custom-tag-input">
          <input type="text" id="customTagInput" placeholder="e.g. epic_scene">
          <button onclick="addCustomTag()"><i class="fas fa-plus"></i> Add</button>
        </div>
      </div>
    </div>
    <div class="categories-container" id="categories"></div>
    <footer>Danbooru Prompt Generator v2.0</footer>
  </div>
  <div class="toast" id="toast"></div>
  <script src="./tags.js"></script>
  <script>
    // JS remains largely unchanged
    const categoriesDiv = document.getElementById("categories");
    const promptField = document.getElementById("promptField");
    const customTagInput = document.getElementById("customTagInput");
    const tagCount = document.getElementById("tagCount");
    const charCount = document.getElementById("charCount");
    const toast = document.getElementById("toast");

    function addTagToPrompt(tag) {
      let current = promptField.value.split(',').map(t => t.trim()).filter(t => t);
      if (!current.includes(tag)) {
        current.push(tag);
        promptField.value = current.join(', ');
        showToast(`${tag} added`);
      }
      updateCounters();
    }
    function addCustomTag() {
      const tag = customTagInput.value.trim();
      if (tag) { addTagToPrompt(tag); customTagInput.value = ''; }
      else { showToast("Enter a tag", 'error'); }
    }
    customTagInput.addEventListener('keypress', e => { if (e.key==='Enter') addCustomTag(); });
    function clearPrompt() { promptField.value=''; updateCounters(); showToast('Cleared'); }
    function copyPrompt() { promptField.select(); document.execCommand('copy'); showToast('Copied'); }
    function addRandomTags() {
      const all=[]; Object.values(tagsByCategory).forEach(arr=>arr.forEach(o=>all.push(o.tag)));
      all.sort(()=>0.5-Math.random()).slice(0,5).forEach(addTagToPrompt);
    }
    function updateCounters() {
      const tags = promptField.value.split(',').filter(t=>t.trim());
      tagCount.textContent = tags.length;
      charCount.textContent = promptField.value.length;
    }
    function showToast(msg, type='success') {
      toast.textContent=msg;
      toast.className='toast show';
      setTimeout(()=>toast.className='toast',1500);
    }
    Object.entries(tagsByCategory).forEach(([cat,tags])=>{
      const card=document.createElement('div'); card.className='category-card';
      const header=document.createElement('div'); header.className='category-header';
      header.onclick=()=>card.classList.toggle('collapsed');
      header.innerHTML=`<h2><i class="fas fa-folder"></i> ${cat}</h2><i class="fas fa-chevron-down"></i>`;
      card.appendChild(header);
      const section=document.createElement('div'); section.className='tag-section';
      tags.forEach(({tag,desc})=>{
        const cont=document.createElement('div'); cont.className='tag-container';
        cont.onclick=()=>addTagToPrompt(tag);
        cont.innerHTML=`<div class="tag">${tag}</div><div class="description">${desc}</div>`;
        section.appendChild(cont);
      });
      card.appendChild(section);
      categoriesDiv.appendChild(card);
    });
    updateCounters();
    promptField.addEventListener('input', updateCounters);
  </script>
</body>
</html>
